###### «ActiveMQConnectionFactory» не должен быть уязвим для десериализации вредоносного кода.

Уязвимость
Незначительный

     Доступно с 19 декабря 2023 г.
     СонарКьюб (Java)
     Постоянно/выпуск: 30 мин.

ActiveMQ может отправлять/получать сообщения объекта JMS (с именем ObjectMessage в контексте ActiveMQ) в соответствии со спецификацией JMS. Внутри ActiveMQ использует механизм сериализации Java для маршалинга/демаршалинга полезной нагрузки сообщения. Десериализация на основе данных, предоставленных пользователем, может привести к атакам с удаленным выполнением кода, при которых структура сериализованных данных изменяется для изменения поведения десериализуемого объекта.

Чтобы ограничить риск стать жертвой такой атаки, ActiveMQ 5.12.2+ заставляет разработчиков явно вносить в белый список пакеты, которыми можно обмениваться с помощью ObjectMessages.
Пример несовместимого кода


ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616");
factory.setTrustAllPackages(true); // Noncompliant

ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616");
// no call to factory.setTrustedPackages(...);

Compliant Solution

ActiveMQConnectionFactory factory = new ActiveMQConnectionFactory("tcp://localhost:61616");
factory.setTrustedPackages(Arrays.asList("org.mypackage1", "org.mypackage2"));

See

    OWASP Top 10 2021 Category A8 - Software and Data Integrity Failures
    OWASP Top 10 2017 Category A8 - Insecure Deserialization
    MITRE, CWE-502 - Deserialization of Untrusted Data
    ActiveMQ ObjectMessage Security Advisory
    CVE-2015-5254





